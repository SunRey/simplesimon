<!DOCTYPE html>
<html>
    <head>
        <meta charset='UTF-8'>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Simple Simon</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
        <!-- <link rel="stylesheet" href="css/main.css"> -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
        <style>
            #color1 { background: red; }
            #color2 { background-color: green; }
            #color3 { background-color: orange; }
            #color4 { background-color: blue; }
            #run_button, #disable_butt { float: right; }
            .shapes {
                width: 120px;
                height: 120px;
                border-radius: 60px;
                display: inline-block;
                opacity: 0.5;
            }
            .shapes:hover{ opacity: 0.7; }
            .shapes:active { opacity: 1; }
            .active {opacity: 1;}
        </style>
    </head>
    <body>

        <div class="container well">
            <h1> Simple Simon Game </h1>
            <div class="jumbotron">
                <a id='color1' class='shapes red' value='1' data-role="button" style="pointer-events: none;"></a>
                <a id='color2' class='shapes grn' value='2' data-role="button" style="pointer-events: none;"></a>
                <a id='color3' class='shapes orng' value='3' data-role="button" style="pointer-events: none;"></a>
                <a id='color4' class='shapes blue' value='4' data-role="button" style="pointer-events: none;"></a>
                <button id='run_button' class='btn btn-success'>Start Game!</button>
                <!-- <button id='disable_butt' class='btn btn-warning'>Enable Pointers!</button> -->
                <h4 class='' id='level_title'>Current level:  <span id='level' class=''>0</span></h4>

            </div>
        </div>

        <script>
        (function() {

            var patternsAndLevel = {
                simonArrayPattern: [],
                userArrayPattern: [],
                currentLevel: 0,
                pushSimonColorToArray: function () {
                    this.simonArrayPattern.push(generateSimonColor());
                },
                pushUserColorArray: function (userChoice) {
                    this.userArrayPattern.push(userChoice);
                    validatePattern();
                    console.log(this.userArrayPattern);
                },
                nextLevel: function () {
                    this.currentLevel++;
                    console.log(this.currentLevel);
                    $('#level').text(this.currentLevel);
                },
                resetLevel: function () {
                    this.currentLevel = 0;
                    $('#level').text(this.currentLevel);                    
                }
            };

            function runGame () {
                patternsAndLevel.nextLevel();
                patternsAndLevel.pushSimonColorToArray();
                controlSimonPattern();
            }
            function pointerEventsAuto () {
                $('.shapes').css('pointer-events', 'auto');
            }
            function pointerEventsNone () {
                $('.shapes').css('pointer-events', 'none');
            }
            function generateSimonColor () {
                return ( Math.floor(Math.random() * (4 - 1 + 1)) + 1);
            }
            function controlSimonPattern () {
                var duration = 1500;
                patternsAndLevel.simonArrayPattern.forEach(function (value) {
                    setTimeout(function(){
                        showSimonPattern(value);
                    }, duration);
                    duration += 900;
                    console.log(duration);
                });
                setTimeout(pointerEventsAuto, duration);
            } 
            function showSimonPattern (pattern) {
                $('#color'+ pattern).addClass('active');
                setTimeout(function () {
                    $('#color' + pattern).removeClass('active');
                }, 500); 
            }
            function validatePattern () {
                var simon = patternsAndLevel.simonArrayPattern,
                    user = patternsAndLevel.userArrayPattern;
                if (user[user.length-1] !== simon[user.length-1]) {
                    gameFail();
                } else {
                    vaildatedSuccess();
                }
            }
            function vaildatedSuccess () {
                if (patternsAndLevel.simonArrayPattern.length === patternsAndLevel.userArrayPattern.length){
                    console.log('Pattern Success');
                    patternsAndLevel.userArrayPattern = [];
                    pointerEventsNone();
                    console.log('valid array clear');
                    runGame();
                }
            }
            function gameFail () {
                patternsAndLevel.userArrayPattern = [];
                patternsAndLevel.simonArrayPattern = [];
                patternsAndLevel.resetLevel();
                pointerEventsNone();
                $('#run_button').attr("disabled", false)
                console.log('fail game; array cleared');
                console.log('Game Over!');
            }

            $('.shapes').on('click', function() {
                var userChoice = parseInt($(this).attr('value'));
                patternsAndLevel.pushUserColorArray(userChoice);
                console.log(this.id);
            })
            $('#run_button').on('click', function() {
                $('#run_button').attr("disabled", true);
                runGame();

            });   
            // $('#disable_butt').on('click', function() {
            //     $('.shapes').css('pointer-events', 'auto');
            // })     

            // showSimonPattern(); function() {
        })();
        </script>
    </body>
</html>